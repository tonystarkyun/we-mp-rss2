# é“¾æ¥ç®¡ç†æ•°æ®åº“æŒä¹…åŒ–ä¿®å¤æ€»ç»“

## é—®é¢˜èƒŒæ™¯

ç”¨æˆ·åé¦ˆåœ¨é“¾æ¥ç®¡ç†åŠŸèƒ½ä¸­ï¼Œè™½ç„¶é“¾æ¥æ·»åŠ æˆåŠŸï¼Œä½†æ˜¯å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç‚¹å‡»"æ·»åŠ é“¾æ¥"æŒ‰é’®æ²¡æœ‰ååº”** - è¡¨å•æäº¤å¤±è´¥
2. **é“¾æ¥æ·»åŠ ååœ¨åˆ—è¡¨ä¸­çœ‹ä¸åˆ°** - æ•°æ®åº“æŒä¹…åŒ–é—®é¢˜  
3. **é€‰ä¸­é“¾æ¥åå³ä¾§æ˜¾ç¤ºå…¬ä¼—å·æ–‡ç« è€Œéé“¾æ¥æ–‡ç« ** - æ•°æ®æŸ¥è¯¢é€»è¾‘é”™è¯¯

## ä¿®å¤è¿‡ç¨‹è¯¦è§£

### ğŸ”§ ç¬¬ä¸€æ­¥ï¼šä¿®å¤è¡¨å•æäº¤é—®é¢˜

**é—®é¢˜è¯Šæ–­**ï¼š
- å‰ç«¯è¡¨å•éªŒè¯å¤±è´¥ï¼Œ`formRef.value.validate()` è¿”å› `undefined`
- HTMLè¡¨å•çš„ `html-type="submit"` æ²¡æœ‰æ­£ç¡®è§¦å‘æäº¤äº‹ä»¶

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```javascript
// é—®é¢˜ä»£ç 
<a-button type="primary" html-type="submit" :loading="loading">

// ä¿®å¤å
<a-button type="primary" @click="handleSubmit" :loading="loading">
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `web_ui/src/views/AddLink.vue` - ä¿®æ”¹æŒ‰é’®è§¦å‘æ–¹å¼å’ŒéªŒè¯é€»è¾‘

**ä¿®å¤å†…å®¹**ï¼š
```javascript
// æ·»åŠ è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯å’Œæ‰‹åŠ¨éªŒè¯
const handleSubmit = async (e) => {
  console.log('è¡¨å•æäº¤è¢«è§¦å‘', e)
  try {
    // æ£€æŸ¥è¡¨å•å¼•ç”¨æ˜¯å¦å­˜åœ¨
    if (!formRef.value) {
      Message.error('è¡¨å•åˆå§‹åŒ–å¤±è´¥')
      return
    }
    
    // æ‰‹åŠ¨éªŒè¯æ›¿ä»£æœ‰é—®é¢˜çš„è‡ªåŠ¨éªŒè¯
    if (!form.value.url) {
      Message.error('è¯·è¾“å…¥ç½‘ç«™URL')
      return
    }
    
    if (!form.value.url.match(/^https?:\/\/.+/)) {
      Message.error('è¯·è¾“å…¥æœ‰æ•ˆçš„URL')
      return
    }
    
    // å‘é€APIè¯·æ±‚...
  } catch (error) {
    console.error('æ·»åŠ é“¾æ¥é”™è¯¯:', error)
  }
}
```

### ğŸ—„ï¸ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé“¾æ¥æ–‡ç« æ•°æ®æ¨¡å‹

**é—®é¢˜åˆ†æ**ï¼š
- åŸç³»ç»Ÿåªæœ‰å…¬ä¼—å·æ–‡ç« (`articles`è¡¨)
- ç¼ºå°‘é“¾æ¥æ–‡ç« çš„ç‹¬ç«‹å­˜å‚¨å’ŒæŸ¥è¯¢æœºåˆ¶
- éœ€è¦å»ºç«‹é“¾æ¥ä¸æ–‡ç« çš„å…³è”å…³ç³»

**è§£å†³æ–¹æ¡ˆ**ï¼š
åˆ›å»ºæ–°çš„æ•°æ®æ¨¡å‹ `LinkArticle` æ¥å­˜å‚¨çˆ¬å–çš„é“¾æ¥æ–‡ç« 

**æ–°å¢æ–‡ä»¶**ï¼š
- `core/models/link_articles.py` - é“¾æ¥æ–‡ç« æ•°æ®æ¨¡å‹

**æ¨¡å‹å®šä¹‰**ï¼š
```python
class LinkArticle(Base):
    """é“¾æ¥æ–‡ç« æ•°æ®æ¨¡å‹"""
    __tablename__ = 'link_articles'
    
    id = Column(String(50), primary_key=True, comment='æ–‡ç« ID')
    link_id = Column(String(50), ForeignKey('links.id'), nullable=False, comment='é“¾æ¥ID')
    title = Column(String(500), nullable=False, comment='æ–‡ç« æ ‡é¢˜')
    url = Column(String(1000), nullable=False, comment='æ–‡ç« URL')
    description = Column(Text, comment='æ–‡ç« æè¿°')
    status = Column(Integer, default=1, comment='çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-ç¦ç”¨ï¼Œ1000-åˆ é™¤')
    publish_time = Column(Integer, comment='å‘å¸ƒæ—¶é—´æˆ³')
    created_at = Column(DateTime, default=func.now(), comment='åˆ›å»ºæ—¶é—´')
    updated_at = Column(DateTime, default=func.now(), onupdate=func.now(), comment='æ›´æ–°æ—¶é—´')
    
    def to_dict(self):
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œå…¼å®¹å‰ç«¯æ˜¾ç¤º"""
        return {
            'id': self.id,
            'link_id': self.link_id,
            'title': self.title,
            'url': self.url,
            'description': self.description or '',
            'status': self.status,
            'publish_time': self.publish_time,
            'mp_name': 'é“¾æ¥æ–‡ç« ',  # å…¼å®¹å‰ç«¯æ˜¾ç¤º
            'account_name': 'é“¾æ¥æ–‡ç« '
        }
```

**æ›´æ–°æ–‡ä»¶**ï¼š
- `core/models/__init__.py` - å¯¼å…¥æ–°æ¨¡å‹

### ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šä¿®å¤é“¾æ¥æ·»åŠ API

**é—®é¢˜**ï¼š
- æ·»åŠ é“¾æ¥æ—¶åªä¿å­˜é“¾æ¥ä¿¡æ¯ï¼Œä¸ä¿å­˜çˆ¬å–çš„æ–‡ç« 
- ç¼ºå°‘æ–‡ç« æ•°æ®çš„æŒä¹…åŒ–é€»è¾‘

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹ `apis/links.py` çš„ `add_link` å‡½æ•°

**ä¿®å¤å†…å®¹**ï¼š
```python
# ä¿å­˜åˆ°æ•°æ®åº“
session.add(new_link)
session.flush()  # è·å–new_link.id

# ä¿å­˜çˆ¬å–çš„æ–‡ç« åˆ°æ•°æ®åº“
if crawl_result['success'] and crawl_result['articles']:
    import time
    for i, article in enumerate(crawl_result['articles']):
        # ç”Ÿæˆå”¯ä¸€IDï¼šæ—¶é—´æˆ³ + é“¾æ¥ID + åºå·
        unique_id = f"{new_link.id}_{int(datetime.now().timestamp())}_{i}"
        link_article = LinkArticle(
            id=unique_id,
            link_id=new_link.id,
            title=article.get('title', ''),
            url=article.get('url', ''),
            description=article.get('title', ''),
            publish_time=int(datetime.now().timestamp()),
            status=1
        )
        session.add(link_article)
        # é¿å…åŒæ—¶é—´æˆ³
        time.sleep(0.001)

session.commit()
```

### ğŸ” ç¬¬å››æ­¥ï¼šä¿®å¤æ–‡ç« æŸ¥è¯¢API

**é—®é¢˜**ï¼š
- æ–‡ç« æŸ¥è¯¢APIåªæŸ¥è¯¢å…¬ä¼—å·æ–‡ç« (`articles`è¡¨)
- ç¼ºå°‘å¯¹é“¾æ¥æ–‡ç« (`link_articles`è¡¨)çš„æŸ¥è¯¢æ”¯æŒ
- å‰ç«¯ä¼ é€’ `link_id` å‚æ•°ä½†åç«¯ä¸å¤„ç†

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹ `apis/article.py` çš„ `get_articles` å‡½æ•°ï¼Œæ”¯æŒé“¾æ¥æ–‡ç« æŸ¥è¯¢

**ä¿®å¤å†…å®¹**ï¼š
```python
@router.api_route("", summary="è·å–æ–‡ç« åˆ—è¡¨",methods= ["GET", "POST"])
async def get_articles(
    offset: int = Query(0, ge=0),
    limit: int = Query(5, ge=1, le=100),
    status: str = Query(None),
    search: str = Query(None),
    mp_id: str = Query(None),
    link_id: str = Query(None),  # æ–°å¢å‚æ•°
    has_content:bool=Query(False),
    current_user: dict = Depends(get_current_user)
):
    session = DB.get_session()
    try:
        # å¦‚æœæ˜¯æŸ¥è¯¢é“¾æ¥æ–‡ç« 
        if link_id:
            from core.models.link_articles import LinkArticle
            query = session.query(LinkArticle)
            
            if status:
                query = query.filter(LinkArticle.status == int(status))
            else:
                query = query.filter(LinkArticle.status != 1000)  # æ’é™¤å·²åˆ é™¤
                
            if link_id != '':  # å¦‚æœä¸æ˜¯æŸ¥è¯¢å…¨éƒ¨
                query = query.filter(LinkArticle.link_id == link_id)
                
            if search:
                query = query.filter(LinkArticle.title.like(f'%{search}%'))
                
            # è·å–æ€»æ•°å’Œåˆ†é¡µ
            total = query.count()
            query = query.order_by(LinkArticle.publish_time.desc()).offset(offset).limit(limit)
            articles = query.all()
            
            # è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
            article_list = [article.to_dict() for article in articles]
            
            return success_response({
                "list": article_list,
                "total": total
            })
        
        # åŸæœ‰çš„å…¬ä¼—å·æ–‡ç« æŸ¥è¯¢é€»è¾‘...
```

### ğŸ› ç¬¬äº”æ­¥ï¼šä¿®å¤IDé‡å¤é—®é¢˜

**é—®é¢˜**ï¼š
- æ•°æ®åº“æ’å…¥æ—¶å‡ºç° `UNIQUE constraint failed: link_articles.id` é”™è¯¯
- ä½¿ç”¨å¾®ç§’æ—¶é—´æˆ³ç”ŸæˆIDåœ¨å¾ªç¯ä¸­å¤ªå¿«å¯¼è‡´é‡å¤

**é—®é¢˜æ—¥å¿—**ï¼š
```
ERROR: (sqlite3.IntegrityError) UNIQUE constraint failed: link_articles.id
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
æ”¹è¿›IDç”Ÿæˆç­–ç•¥ï¼Œä½¿ç”¨ç»„åˆå”¯ä¸€ID

**ä¿®å¤å†…å®¹**ï¼š
```python
# é—®é¢˜ä»£ç 
id=str(int(datetime.now().timestamp() * 1000000))[:50]

# ä¿®å¤å
unique_id = f"{new_link.id}_{int(datetime.now().timestamp())}_{i}"
```

### ğŸ“ æ¶‰åŠçš„æ‰€æœ‰æ–‡ä»¶ä¿®æ”¹

**æ–°å¢æ–‡ä»¶**ï¼š
1. `core/models/link_articles.py` - é“¾æ¥æ–‡ç« æ•°æ®æ¨¡å‹

**ä¿®æ”¹æ–‡ä»¶**ï¼š
1. `core/models/__init__.py` - å¯¼å…¥æ–°æ¨¡å‹
2. `apis/links.py` - ä¿®å¤æ·»åŠ é“¾æ¥APIï¼Œæ”¯æŒæ–‡ç« æ•°æ®ä¿å­˜
3. `apis/article.py` - ä¿®å¤æ–‡ç« æŸ¥è¯¢APIï¼Œæ”¯æŒé“¾æ¥æ–‡ç« æŸ¥è¯¢
4. `web_ui/src/views/AddLink.vue` - ä¿®å¤è¡¨å•æäº¤å’ŒéªŒè¯é€»è¾‘

**æ•°æ®åº“å˜æ›´**ï¼š
- æ–°å¢ `link_articles` è¡¨ç”¨äºå­˜å‚¨é“¾æ¥æ–‡ç« æ•°æ®

## æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ€è·¯

### 1. è¡¨å•éªŒè¯é—®é¢˜
- **éš¾ç‚¹**ï¼šArco Designçš„è¡¨å•éªŒè¯åœ¨æŸäº›æƒ…å†µä¸‹è¿”å›`undefined`
- **è§£å†³**ï¼šæ·»åŠ æ‰‹åŠ¨éªŒè¯é€»è¾‘ï¼Œç¡®ä¿è¡¨å•æäº¤çš„ç¨³å®šæ€§

### 2. æ•°æ®æ¨¡å‹è®¾è®¡
- **éš¾ç‚¹**ï¼šéœ€è¦å…¼å®¹ç°æœ‰å…¬ä¼—å·æ–‡ç« ç³»ç»Ÿçš„å‰ç«¯æ˜¾ç¤ºé€»è¾‘
- **è§£å†³**ï¼šåœ¨`to_dict()`æ–¹æ³•ä¸­æ·»åŠ å…¼å®¹å­—æ®µå¦‚`mp_name`

### 3. å”¯ä¸€IDç”Ÿæˆ
- **éš¾ç‚¹**ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹æ—¶é—´æˆ³å¯èƒ½é‡å¤
- **è§£å†³**ï¼šä½¿ç”¨ç»„åˆIDï¼ˆé“¾æ¥ID + æ—¶é—´æˆ³ + åºå·ï¼‰ç¡®ä¿å”¯ä¸€æ€§

### 4. APIè·¯ç”±è®¾è®¡
- **éš¾ç‚¹**ï¼šåŒä¸€ä¸ªæ–‡ç« æŸ¥è¯¢APIéœ€è¦æ”¯æŒä¸¤ç§ä¸åŒçš„æ•°æ®æº
- **è§£å†³**ï¼šé€šè¿‡å‚æ•°åˆ¤æ–­ï¼ŒåŠ¨æ€é€‰æ‹©æŸ¥è¯¢çš„æ•°æ®è¡¨å’Œæ¨¡å‹

## åŠŸèƒ½éªŒè¯

### æµ‹è¯•åœºæ™¯
1. **æ·»åŠ æ–°é“¾æ¥**ï¼šè¾“å…¥URL â†’ çˆ¬è™«æµ‹è¯• â†’ æ·»åŠ æˆåŠŸ
2. **æŸ¥çœ‹é“¾æ¥åˆ—è¡¨**ï¼šæ˜¾ç¤ºæ‰€æœ‰å·²æ·»åŠ çš„é“¾æ¥
3. **æŸ¥çœ‹é“¾æ¥æ–‡ç« **ï¼šç‚¹å‡»é“¾æ¥ â†’ å³ä¾§æ˜¾ç¤ºè¯¥é“¾æ¥çš„æ–‡ç« åˆ—è¡¨
4. **æ–‡ç« æœç´¢**ï¼šæ”¯æŒæŒ‰æ ‡é¢˜æœç´¢é“¾æ¥æ–‡ç« 

### éªŒè¯ç½‘ç«™
- âœ… https://dev.to - æˆåŠŸæ·»åŠ å¹¶æ˜¾ç¤ºæ–‡ç« 
- âœ… https://news.ycombinator.com - çˆ¬è™«æµ‹è¯•æˆåŠŸ
- âœ… https://lobste.rs - çˆ¬è™«æµ‹è¯•æˆåŠŸ

## å½“å‰çŠ¶æ€

### âœ… å·²å®ŒæˆåŠŸèƒ½
1. é“¾æ¥æ·»åŠ åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. æ•°æ®åº“æŒä¹…åŒ–é€»è¾‘å®Œæ•´
3. å‰åç«¯æ•°æ®æµé€šç•…
4. æ–‡ç« æŸ¥è¯¢é€»è¾‘æ”¯æŒé“¾æ¥æ–‡ç« 
5. è¡¨å•éªŒè¯å’Œæäº¤ç¨³å®š

### ğŸ”„ å¾…æµ‹è¯•éªŒè¯
1. é“¾æ¥æ–‡ç« çš„å®Œæ•´æ˜¾ç¤ºæµç¨‹
2. IDå”¯ä¸€æ€§åœ¨å®é™…ç¯å¢ƒä¸­çš„ç¨³å®šæ€§
3. å¤§é‡æ–‡ç« æ—¶çš„æŸ¥è¯¢æ€§èƒ½

### ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘
1. æ·»åŠ æ–‡ç« å†…å®¹çš„å®Œæ•´çˆ¬å–å’Œå­˜å‚¨
2. å®ç°é“¾æ¥çš„å®šæ—¶æ›´æ–°æœºåˆ¶
3. ä¼˜åŒ–çˆ¬è™«çš„æˆåŠŸç‡å’Œé”™è¯¯å¤„ç†
4. æ·»åŠ æ–‡ç« çš„RSSè®¢é˜…ç”ŸæˆåŠŸèƒ½

## å¼€å‘ç¯å¢ƒçŠ¶æ€

### æœåŠ¡çŠ¶æ€
- **åç«¯æœåŠ¡**ï¼šhttp://localhost:8001 (è¿è¡Œä¸­)
- **å‰ç«¯å¼€å‘æœåŠ¡**ï¼šhttp://localhost:3002 (è¿è¡Œä¸­)
- **æ•°æ®åº“**ï¼šSQLite (link_articlesè¡¨å·²åˆ›å»º)

### å¯åŠ¨å‘½ä»¤
```bash
# åç«¯
python main.py -job True -init True

# å‰ç«¯  
cd web_ui && npm run dev
```

### å…³é”®é…ç½®
- å‰ç«¯å¼€å‘ç«¯å£ï¼š3002 (3000å’Œ3001è¢«å ç”¨)
- APIè¶…æ—¶æ—¶é—´ï¼š30ç§’ (é€‚é…çˆ¬è™«æ“ä½œ)
- æ•°æ®åº“ï¼šè‡ªåŠ¨åˆ›å»ºå’ŒåŒæ­¥

## ä»£ç è´¨é‡

### æ·»åŠ çš„è°ƒè¯•åŠŸèƒ½
- å‰ç«¯è¡¨å•æäº¤æ·»åŠ è¯¦ç»†æ—¥å¿—
- APIå“åº”ç»“æ„è°ƒè¯•è¾“å‡º
- åç«¯é”™è¯¯è¯¦ç»†è®°å½•

### é”™è¯¯å¤„ç†
- è¡¨å•éªŒè¯å¤±è´¥çš„ä¼˜é›…é™çº§
- æ•°æ®åº“æ“ä½œçš„äº‹åŠ¡å›æ»š
- çˆ¬è™«å¤±è´¥æ—¶çš„é”™è¯¯æç¤º

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025å¹´8æœˆ28æ—¥  
**å¼€å‘çŠ¶æ€**: ğŸ”„ å¾…æœ€ç»ˆæµ‹è¯•éªŒè¯  
**ä¸‹æ¬¡å¼€å‘é‡ç‚¹**: éªŒè¯é“¾æ¥æ–‡ç« æ˜¾ç¤ºåŠŸèƒ½å’Œå®Œå–„æ•°æ®æŒä¹…åŒ–æµç¨‹